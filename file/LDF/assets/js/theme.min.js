let list_temp={code_list:[],pool_list:[],host_list:[]},lang_pack={mycode_tb_copy:"Copy",mycode_tb_gift:"Gift",mycode_tb_del:"Delete",card_type_speed:"先搶先贏",card_type_timeup:"截止抽選",card_type_pool_pub:"公池",card_type_pool_private:"私池",card_type_resource:"募集箱"};function start_run(){document.getElementById("add_limit_date").value="2724-04-13T19:02",document.getElementById("footer_power").textContent="© LinuxDoFuri "+(new Date).getFullYear();let e=document.querySelector(".sidebar"),t=document.querySelectorAll("#sidebarToggle, #sidebarToggleTop");if(e){let n=[].slice.call(document.querySelectorAll(".sidebar .collapse")).map((function(e){return new bootstrap.Collapse(e,{toggle:!1})}));for(let o of t)o.addEventListener("click",(function(t){if(document.body.classList.toggle("sidebar-toggled"),e.classList.toggle("toggled"),e.classList.contains("toggled"))for(let e of n)e.hide()}));window.addEventListener("resize",(function(){if(Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)<768)for(let e of n)e.hide()}))}let n=document.querySelector("body.fixed-nav .sidebar");n&&n.on("mousewheel DOMMouseScroll wheel",(function(e){if(Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)>768){let t=e.originalEvent,n=t.wheelDelta||-t.detail;this.scrollTop+=30*(n<0?1:-1),e.preventDefault()}}));let o=document.querySelector(".scroll-to-top");o&&window.addEventListener("scroll",(function(){let e=window.scrollY;o.style.display=e>100?"block":"none"}))}function redeem_form_function(e){document.getElementById("redeem_form").addEventListener("submit",(function(t){t.preventDefault(),btn_locker("redeem_code",!0);const n=new XMLHttpRequest;n.open("POST","/api/code/redeem",!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify({redeem_code:document.getElementById("code_secret_input").value})),n.onreadystatechange=function(){if(4!==n.readyState||200!==n.status)return;const t=JSON.parse(n.responseText);if("success"!==t.result)return alert(`${t.reason}`),void btn_locker("redeem_code",!1);let o;if(1===t.event_type&&t.key_info.length>0)o=t.redeemed_key,update_my_codes(t.key_info,e);else{if(2===t.event_type)return alert("Joined !"),void btn_locker("redeem_code",!1);3===t.event_type||4===t.event_type?o=t.redeemed_key:5===t.event_type&&t.joined_list&&(o=JSON.stringify(t.joined_list))}navigator.clipboard.writeText(o).then((()=>{alert("Copied !")})).catch((e=>{console.error("Failed to Copy : ",e)})),btn_locker("redeem_code",!1),showArea("my_codes")}}))}function add_form_function(e){document.getElementById("add_form").addEventListener("submit",(function(t){t.preventDefault(),btn_locker("sub_keys",!0);const n=new XMLHttpRequest;n.open("POST","/api/code/add",!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify({event:document.getElementById("add_event").value,info:document.getElementById("add_info").value,type:document.getElementById("add_type").value,date_expire:new Date(document.getElementById("add_limit_date").value).getTime(),keys:document.getElementById("add_key_per_line").value,key_reuse:document.getElementById("add_reuse").value,lv_limit:document.getElementById("add_lvl").value,ban_list:document.getElementById("add_ban_per_line").value,key_per_acc:document.getElementById("add_redeem_count").value,redeem_code:document.getElementById("add_code_secret").value})),n.onreadystatechange=function(){if(4!==n.readyState||200!==n.status)return;const t=JSON.parse(n.responseText);if("success"!==t.result)return alert(`${t.reason?t.reason:"I don't even know HOW ???"}`),void btn_locker("sub_keys",!1);list_temp.host_list=t.hosted_events,navigator.clipboard.writeText(t.redeem_code).then((()=>{alert("Copied !")})).catch((e=>{console.error("Failed to Copy : ",e)})),update_my_hosts(list_temp.host_list,e),update_my_hosts(list_temp.pool_list,e,!1),document.getElementById("add_code_secret").value=t.redeem_code?t.redeem_code:"ERROR",btn_locker("sub_keys",!1),showArea("my_hosted_codes")}}))}function countCharacters(){let e=document.getElementById("add_key_per_line"),t=document.getElementById("key_word_counter"),n=document.getElementById("add_ban_per_line"),o=document.getElementById("ban_word_counter");t.innerText=`${e.value.split("\n").length} s, ( ${e.value.length} / 4000 )`,o.innerText=`${n.value.split("\n").length} s, ( ${n.value.length} / 400 )`}function showArea(e="my_codes"){["my_codes","add_code_panel","my_hosted_codes"].forEach((t=>{try{let n;if(t!==e)return n=document.getElementById(t),n.style.transform="translateX(-100vw)",void(n.style.filter="blur(45px)");n=document.getElementById(t),n.style.transform="translateX(0vw)",n.style.filter="blur(0px)"}catch(e){}}))}function update_my_codes(e=[],t,n=!0){let o=document.getElementById("my_codes_table");n&&(o.innerHTML=""),e.forEach((e=>{e.keys.forEach((n=>{o.innerHTML+=`\n            <tr>\n                <td><img class="rounded-circle me-2" width="30" height="30" src="https://cdn.linux.do/user_avatar/linux.do/${e.owner_linuxdo_name}/64/1.png" /><input class="form-control-plaintext d-inline-block w-auto py-2" type="text" value="${e.owner_linuxdo_name}" readonly /></td>\n                <td><input class="form-control-plaintext d-inline-block w-auto py-2" type="text" value="${n}" readonly /></td>\n                <td><input class="form-control-plaintext d-inline-block w-auto py-2" type="text" value="${e.info}" readonly /></td>\n                <td><span class="d-inline-block w-auto py-2">${new Date(e.expire_date).toLocaleDateString("en-CA")}</span></td>\n                <td><button id="my_copy_code_${e.event_uuid}_${n}" class="btn btn-secondary mx-1" type="button" onclick="navigator.clipboard.writeText('${n}')">${t.mycode_tb_copy}</button>\n                <button id="my_gift_code_${e.event_uuid}_${n}" class="btn btn-secondary mx-1" type="button" onclick="gift_code('${e.event_uuid}','${n}')">${t.mycode_tb_gift}</button>\n                <button id="my_delete_code_${e.event_uuid}_${n}" class="btn btn-danger mx-1" type="button" onclick="delete_code('${e.event_uuid}','${n}')">${t.mycode_tb_del}</button></td>\n            </tr>\n        `}))}))}function update_my_hosts(e=[],t,n=!0){let o=document.getElementById("my_hosts_table");n&&(o.innerHTML=""),e.forEach((e=>{let n;switch(e.type){case 1:n=t.card_type_speed;break;case 2:n=t.card_type_timeup;break;case 3:n=t.card_type_pool_pub;break;case 4:n=t.card_type_pool_private;break;case 5:n=t.card_type_resource;break;default:n="Unknown"}e.keys.forEach((d=>{o.innerHTML=`\n            <tr>\n                <td><span class="d-inline-block w-auto py-2">${e.event_uuid}</span></td>\n                <td><span class="d-inline-block w-auto py-2">${e.event}</span></td>\n                <td><input class="form-control-plaintext d-inline-block w-auto py-2" type="text" value="${d}" readonly /></td>\n                <td><input class="form-control-plaintext d-inline-block w-auto py-2" type="text" value="${e.info}" readonly /></td>\n                <td><span class="d-inline-block w-auto py-2">${e.expire_date}</span></td>\n                <td><span class="d-inline-block w-auto py-2">${n}</span></td>\n                <td><button id="host_delete_code_${e.event_uuid}_${d}" class="btn btn-danger mx-1" type="button" data-bs-target="#modal-pop" data-bs-toggle="modal" onclick="delete_host('${e.event_uuid}','${d}')">${t.mycode_tb_del}</button></td>\n            </tr>\n        ${o.innerHTML}`}))}))}function delete_host(e,t){const n=new XMLHttpRequest;n.open("POST","/api/code/del",!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify({key:t,redeem_code:e})),n.onreadystatechange=function(){if(4!==n.readyState||200!==n.status)return;const e=JSON.parse(n.responseText);"fail"!==e.result?"new"!==e.result&&"success"===e.result&&e.user_info.key_info.length>0&&(list_temp.code_list=e.user_info.key_info,list_temp.host_list=e.user_info.hosted_events,list_temp.pool_list=e.user_info.pool_info,update_my_codes(list_temp.code_list,lang_pack),update_my_hosts(list_temp.host_list,lang_pack),update_my_hosts(list_temp.pool_list,lang_pack,!1)):alert(`${e.reason}`)}}function update_all_panel(e){const t=new XMLHttpRequest;t.open("GET","/api/user/get",!0),t.send(),t.onreadystatechange=function(){if(4!==t.readyState||200!==t.status)return;const n=JSON.parse(t.responseText);"fail"!==n.result?"new"!==n.result&&"success"===n.result&&n.user_info.key_info.length>0&&(list_temp.code_list=n.user_info.key_info,list_temp.host_list=n.user_info.hosted_events,list_temp.pool_list=n.user_info.pool_info,update_my_codes(list_temp.code_list,e),update_my_hosts(list_temp.host_list,e),update_my_hosts(list_temp.pool_list,e,!1)):alert(`${n.reason}`)}}function btn_locker(e,t=!0){t?document.getElementById(e).setAttribute("disabled",""):document.getElementById(e).removeAttribute("disabled"),document.getElementById(e).classList.toggle("progress-bar-striped"),document.getElementById(e).classList.toggle("btn-danger"),document.getElementById(e).classList.toggle("btn-warning")}!function(){"use strict";try{start_run(),showArea(),update_all_panel(lang_pack),redeem_form_function(lang_pack),add_form_function(lang_pack)}catch(e){}}();